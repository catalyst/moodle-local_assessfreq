/**
 * Javascript for report card display and processing.
 *
 * @package    local_assessfreq
 * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_assessfreq/override_modal",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax"],(function($,Str,ModalFactory,ModalEvents,Fragment,Ajax){var contextid,modalObj,callback,quizid,userid,hoursFilter,OverrideModal={};const spinner='<p class="text-center"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i></p>',createModal=function(){Str.get_string("loading","local_assessfreq").then((title=>{ModalFactory.create({type:ModalFactory.types.DEFAULT,title:title,body:spinner,large:!0}).done((modal=>{(modalObj=modal).getRoot().on("click","#id_submitbutton",processModalForm),modalObj.getRoot().on("click","#id_cancel",(function(e){e.preventDefault(),modalObj.setBody(spinner),modalObj.hide()}))}))}))},updateModalBody=function(quiz,user,formdata){void 0===formdata&&(formdata={});let params={jsonformdata:JSON.stringify(formdata),quizid:quiz,userid:user};modalObj.setBody(spinner),Str.get_string("useroverride","local_assessfreq").then((title=>{modalObj.setTitle(title),modalObj.setBody(Fragment.loadFragment("local_assessfreq","new_override_form",contextid,params))}))};function processModalForm(e){e.preventDefault();let overrideform=modalObj.getRoot().find("form").serialize(),formjson=JSON.stringify(overrideform);var invalid=$.merge(modalObj.getRoot().find('[aria-invalid="true"]'),modalObj.getRoot().find(".error"));invalid.length?invalid.first().focus():Ajax.call([{methodname:"local_assessfreq_process_override_form",args:{jsonformdata:formjson,quizid:quizid}}])[0].done((()=>{modalObj.setBody(spinner),modalObj.hide(),hoursFilter?callback(quizid,hoursFilter):callback(quizid)})).fail((()=>{updateModalBody(quizid,userid,overrideform)}))}return OverrideModal.displayModalForm=function(quiz,user){let hours=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;quizid=quiz,userid=user,hoursFilter=hours,updateModalBody(quiz,user),modalObj.show()},OverrideModal.init=function(context,callbackFunction){let hours=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;contextid=context,callback=callbackFunction,hoursFilter=hours,createModal()},OverrideModal}));

//# sourceMappingURL=override_modal.min.js.map