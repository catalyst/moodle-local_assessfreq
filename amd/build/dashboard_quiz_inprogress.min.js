define ("local_assessfreq/dashboard_quiz_inprogress",["jquery","core/ajax","core/templates","core/fragment","local_assessfreq/zoom_modal","core/str","core/notification"],function(a,b,c,d,e,f,g){var h={},i,j=60,k,l="name_asc",m=0,n=0,o=[{cardId:"local-assessfreq-quiz-summary-upcomming-graph",call:"upcomming_quizzes",aspect:!0},{cardId:"local-assessfreq-quiz-summary-inprogress-graph",call:"all_participants_inprogress",aspect:!0}],p=function(a,c){return b.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:a,value:c}]}}])[0]},q=function(a){return b.call([{methodname:"local_assessfreq_get_user_preferences",args:{name:a}}])[0]},r=function debouncer(a,b){var c;return function(){for(var d=arguments.length,e=Array(d),f=0;f<d;f++){e[f]=arguments[f]}var g=function(){clearTimeout(c);a.apply(void 0,e)};clearTimeout(c);c=setTimeout(g,b)}}(function(){A()},750),s=function(a){var b=document.getElementById("local-assessfreq-period-progress");if(!0==a){clearInterval(k);k=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100)}if(k){return}k=setInterval(function(){var a=b.getAttribute("aria-valuenow"),c=100/j;if(0<a-c){b.setAttribute("style","width: "+(a-c)+"%");b.setAttribute("aria-valuenow",a-c)}else{clearInterval(k);k=null;b.setAttribute("style","width: 100%");b.setAttribute("aria-valuenow",100);B();s()}},1e3)},t=function(a){if("Meta"===a.key||a.ctrlKey){return!1}if(0===a.target.value.length||2<a.target.value.length){r()}},u=function(){var a=document.getElementById("local-assessfreq-quiz-inprogress-table-search");a.value="";a.focus();A()},v=function(){o.forEach(function(a){var b=document.getElementById(a.cardId),e=b.getElementsByClassName("overlay-icon-container")[0],h=b.getElementsByClassName("chart-body")[0],j={data:JSON.stringify({call:a.call,hoursahead:m,hoursbehind:n})};e.classList.remove("hide");d.loadFragment("local_assessfreq","get_quiz_inprogress_chart",i,j).done(function(b){var d=JSON.parse(b);if(!0==d.hasdata){var i={withtable:!0,chartdata:JSON.stringify(d.chart),aspect:a.aspect};c.render("local_assessfreq/chart",i).done(function(a,b){e.classList.add("hide");c.replaceNodeContents(h,a,b)}).fail(function(){g.exception(new Error("Failed to load chart template."))})}else{f.get_string("nodata","local_assessfreq").then(function(a){var b=document.createElement("h3");b.innerHTML=a;h.innerHTML=b.outerHTML;e.classList.add("hide")}).catch(function(){g.exception(new Error("Failed to load string: nodata"))})}}).fail(function(){g.exception(new Error("Failed to load card."))})})},w=function(a){a.preventDefault();var b=new URL(a.target.closest("a").href),c=b.searchParams.get("page");if(c){A(c)}},x=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){for(var b=a.target.dataset.metric,c=document.getElementById("local-assessfreq-quiz-inprogress-table-rows").getElementsByClassName("active"),d=0;d<c.length;d++){c[d].classList.remove("active")}a.target.classList.add("active");p("local_assessfreq_quiz_table_inprogress_preference",b).then(function(){A()}).fail(function(){g.exception(new Error("Failed to update user preference: rows"))})}},y=function(a){a.preventDefault();var b=a.target;if("a"===b.tagName.toLowerCase()&&b.dataset.sort!=l){l=b.dataset.sort;for(var c=b.parentNode.getElementsByTagName("a"),d=0;d<c.length;d++){c[d].classList.remove("active")}b.classList.add("active");p("local_assessfreq_quiz_table_inprogress_sort_preference",l);r()}},z=function(){var a=document.getElementById("local-assessfreq-quiz-inprogress-table"),b=a.querySelectorAll("nav");b.forEach(function(a){a.addEventListener("click",w)})},A=function(b){if("undefined"==typeof b){b=0}var e=document.getElementById("local-assessfreq-quiz-inprogress-table"),f=e.getElementsByClassName("overlay-icon-container")[0],h=e.getElementsByClassName("table-body")[0],j=document.getElementById("local-assessfreq-quiz-inprogress-table-search").value.trim(),k=l.split("_"),o=k[0],p=k[1],q={data:JSON.stringify({search:j,page:b,sorton:o,direction:p,hoursahead:m,hoursbehind:n})};f.classList.remove("hide");d.loadFragment("local_assessfreq","get_quizzes_inprogress_table",i,q).done(function(b,d){h.innerHTML=b;c.runTemplateJS(d);f.classList.add("hide");z();a("[data-toggle=\"tooltip\"]").tooltip()}).fail(function(){g.exception(new Error("Failed to update table."))})},B=function(){b.call([{methodname:"local_assessfreq_get_inprogress_counts",args:{}}])[0].then(function(b){var d=JSON.parse(b),e=document.getElementById("local-assessfreq-quiz-dashboard-inprogress-summary-card"),f=e.getElementsByClassName("overlay-icon-container")[0],h=document.getElementById("local-assessfreq-quiz-inprogress-table-search"),i=document.getElementById("local-assessfreq-quiz-inprogress-table-search-reset"),j=document.getElementById("local-assessfreq-quiz-inprogress-table-rows"),k=document.getElementById("local-assessfreq-inprogress-table-sort");e.classList.remove("hide");c.render("local_assessfreq/quiz-dashboard-inprogress-summary-card-content",d).done(function(a){f.classList.add("hide");var b=document.getElementById("local-assessfreq-quiz-dashboard-inprogress-summary-card-content");c.replaceNodeContents(b,a)}).fail(function(){g.exception(new Error("Failed to load quiz counts template."))});v();A();s();h.addEventListener("keyup",t);h.addEventListener("paste",t);i.addEventListener("click",u);j.addEventListener("click",x);k.addEventListener("click",y);a("[data-toggle=\"tooltip\"]").tooltip()}).fail(function(){g.exception(new Error("Failed to get quiz summary counts"))})},C=function(a){a.preventDefault();var b=a.target;if(null!==b.closest("button")&&"local-assessfreq-refresh-quiz-dashboard"==b.closest("button").id){s(!0);B()}else if("a"===b.tagName.toLowerCase()){var c=document.getElementById("local-assessfreq-period-container"),d=c.getElementsByClassName("dropdown-toggle")[0];d.textContent=b.innerHTML;for(var e=c.getElementsByClassName("active"),f=0;f<e.length;f++){e[f].classList.remove("active")}b.classList.add("active");j=b.dataset.period;s(!0);p("local_assessfreq_quiz_refresh_preference",j)}},D=function(a){var b=a.target.closest("div").dataset.call,c={data:JSON.stringify({call:b})};e.zoomGraph(a,c,"get_quiz_inprogress_chart")},E=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){var b=a.target.dataset.metric;p("local_assessfreq_quizzes_inprogress_table_hoursahead_preference",b).then(function(){m=b;B()}).fail(function(){g.exception(new Error("Failed to update user preference: hours ahead"))})}},F=function(a){a.preventDefault();if("a"===a.target.tagName.toLowerCase()){var b=a.target.dataset.metric;p("local_assessfreq_quizzes_inprogress_table_hoursbehind_preference",b).then(function(){n=b;B()}).fail(function(){g.exception(new Error("Failed to update user preference: hours behind"))})}};h.init=function(a){i=a;e.init(a);q("local_assessfreq_quiz_refresh_preference").then(function(a){j=a.preferences[0].value?a.preferences[0].value:60}).fail(function(){g.exception(new Error("Failed to get use preference: refresh"))});q("local_assessfreq_quiz_table_inprogress_sort_preference").then(function(a){l=a.preferences[0].value?a.preferences[0].value:"name_asc"}).fail(function(){g.exception(new Error("Failed to get use preference: tablesort"))});q("local_assessfreq_quizzes_inprogress_table_hoursahead_preference").then(function(a){m=a.preferences[0].value?a.preferences[0].value:0}).fail(function(){g.exception(new Error("Failed to get use preference: hoursahead"))});q("local_assessfreq_quizzes_inprogress_table_hoursbehind_preference").then(function(a){n=a.preferences[0].value?a.preferences[0].value:0}).fail(function(){g.exception(new Error("Failed to get use preference: hoursbehind"))});var b=document.getElementById("local-assessfreq-period-container");b.addEventListener("click",C);var c=document.getElementById("local-assessfreq-quiz-summary-inprogress-graph-zoom");c.addEventListener("click",D);var d=document.getElementById("local-assessfreq-quiz-summary-upcomming-graph-zoom");d.addEventListener("click",D);var f=document.getElementById("local-assessfreq-quiz-student-table-hoursahead");f.addEventListener("click",E);var h=document.getElementById("local-assessfreq-quiz-student-table-hoursbehind");h.addEventListener("click",F);B()};return h});
//# sourceMappingURL=dashboard_quiz_inprogress.min.js.map
